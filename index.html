<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>AI Music Converter</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{
  box-sizing:border-box;
}

body{
  margin:0;
  min-height:100vh;
  background:#020617;
  color:white;
  font-family:Arial, sans-serif;

  display:flex;
  justify-content:center;
  align-items:center;
}

/* CENTER WRAPPER */
.main-wrapper{
  width:100%;
  display:flex;
  justify-content:center;
  padding:15px;
}

/* MAIN BOX */
.box{
  background:#0f172a;
  padding:20px;
  border-radius:16px;
  width:100%;
  max-width:420px;
  text-align:center;
  box-shadow:0 0 25px rgba(0,255,204,0.15);
}

h2{
  margin-top:0;
}

input, select, button{
  margin-top:12px;
  padding:12px;
  width:100%;
  border-radius:10px;
  border:none;
  font-size:15px;
}

button{
  background:#00ffcc;
  font-weight:bold;
  cursor:pointer;
}

button:active{
  transform:scale(0.98);
}

audio{
  width:100%;
  margin-top:12px;
}

#status{
  margin-top:10px;
  font-size:14px;
  color:#7fffd4;
}

small{
  opacity:0.7;
  display:block;
  margin-bottom:10px;
}

.disclaimer{
  font-size:12px;
  opacity:0.6;
  margin-top:15px;
}
</style>
</head>

<body>

<div class="main-wrapper">
  <div class="box">
    <h2>üéµ AI Music Converter</h2>
    <small>Any Song ‚Üí Slow / Fast / Lofi</small>

    <input type="file" id="file" accept="audio/*">

    <select id="mode">
      <option value="slow">üê¢ Slow Song</option>
      <option value="fast">‚ö° Fast Song</option>
      <option value="lofi">üéß Lofi Song</option>
    </select>

    <button onclick="convert()">Convert & Play</button>
    <button onclick="download()">Download Audio</button>

    <audio id="player" controls></audio>
    <div id="status"></div>

    <div class="disclaimer">
      ‚ö†Ô∏è Disclaimer: This website does not host or upload any music.  
      All audio processing happens locally in your browser.  
      Users are responsible for the content they use.
    </div>
  </div>
</div>

<script>
let audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let sourceNode;
let bufferData;

function convert(){
  const fileInput = document.getElementById("file");
  if(!fileInput.files[0]){
    alert("‡§™‡§π‡§≤‡•á ‡§ï‡•ã‡§à song upload ‡§ï‡§∞‡•ã");
    return;
  }

  const reader = new FileReader();
  reader.readAsArrayBuffer(fileInput.files[0]);

  reader.onload = async () => {
    bufferData = await audioCtx.decodeAudioData(reader.result);

    if(sourceNode) sourceNode.stop();

    sourceNode = audioCtx.createBufferSource();
    sourceNode.buffer = bufferData;

    const mode = document.getElementById("mode").value;
    let rate = 1;

    if(mode === "slow") rate = 0.7;
    if(mode === "fast") rate = 1.3;
    if(mode === "lofi") rate = 0.8;

    sourceNode.playbackRate.value = rate;
    sourceNode.connect(audioCtx.destination);
    sourceNode.start();

    document.getElementById("player").src = "";
    document.getElementById("status").innerText =
      "‚úÖ Converted Mode: " + mode.toUpperCase();
  };
}

function download(){
  if(!bufferData){
    alert("‡§™‡§π‡§≤‡•á convert ‡§ï‡§∞‡•ã");
    return;
  }

  const channel = bufferData.getChannelData(0);
  const wav = encodeWAV(channel);
  const blob = new Blob([wav], {type:"audio/wav"});

  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "Converted_Music.wav";
  a.click();
}

function encodeWAV(samples){
  const buffer = new ArrayBuffer(44 + samples.length * 2);
  const view = new DataView(buffer);
  const rate = 44100;

  function writeString(offset, str){
    for(let i=0;i<str.length;i++){
      view.setUint8(offset+i, str.charCodeAt(i));
    }
  }

  writeString(0,"RIFF");
  view.setUint32(4,36+samples.length*2,true);
  writeString(8,"WAVE");
  writeString(12,"fmt ");
  view.setUint32(16,16,true);
  view.setUint16(20,1,true);
  view.setUint16(22,1,true);
  view.setUint32(24,rate,true);
  view.setUint32(28,rate*2,true);
  view.setUint16(32,2,true);
  view.setUint16(34,16,true);
  writeString(36,"data");
  view.setUint32(40,samples.length*2,true);

  let offset = 44;
  for(let i=0;i<samples.length;i++){
    let s = Math.max(-1, Math.min(1, samples[i]));
    view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7fff, true);
    offset += 2;
  }
  return view;
}
</script>

</body>
</html>
